{% extends "base.html" %}

{% block title %}Manage Leaderboards{% endblock %}

{% block content %}
<section class="content-wrap">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
        <a href="{{ url_for('admin_dashboard') }}" onclick="(function(e){e.preventDefault();try{var r=document.referrer;if(r && new URL(r).origin===location.origin){history.back();}else{window.location=this.getAttribute('href');}}catch(err){window.location=this.getAttribute('href');}}).call(this,event);" class="hero-btn hero-btn-outline small" aria-label="Go back">Back</a>
        <h1 style="margin:0">Leaderboards</h1>
    </div>

    <div class="admin-card" style="margin-top:12px;">
        <h2 style="margin-top:0;">Add leaderboard row</h2>
        <form method="post" action="/admin/leaderboards" class="admin-match-form">
            <label>Team name</label>
            <input type="text" name="team" required>

            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
                <div style="flex:1"><label>Played (pl)</label><input type="number" name="pl" min="0"></div>
                <div style="flex:1"><label>Won (w)</label><input type="number" name="w" min="0"></div>
                <div style="flex:1"><label>Drawn (d)</label><input type="number" name="d" min="0"></div>
                <div style="flex:1"><label>Lost (l)</label><input type="number" name="l" min="0"></div>
            </div>

            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
                <div style="flex:1"><label>For (pts_f)</label><input type="number" name="pts_f" min="0"></div>
                <div style="flex:1"><label>Against (pts_ag)</label><input type="number" name="pts_ag" min="0"></div>
                <div style="flex:1"><label>Points diff (pts_diff)</label><input type="number" name="pts_diff"></div>
            </div>

            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
                <div style="flex:1"><label>G points (g_pts)</label><input type="number" name="g_pts" min="0"></div>
                <div style="flex:1"><label>B points (b_pts)</label><input type="number" name="b_pts" min="0"></div>
                <div style="flex:1"><label>Total</label><input type="number" name="total" min="0"></div>
            </div>

            <label style="margin-top:8px;">Points scored (pts_scored)</label>
            <input type="number" name="pts_scored" min="0">

            <div class="admin-match-actions">
                <button class="hero-btn hero-btn-primary" type="submit">Add row</button>
            </div>
        </form>
    </div>

    <h2 style="margin-top:18px">Current rows</h2>
    <div class="admin-card">
        <table class="admin-matches-table">
            <thead>
                <tr><th>Rank</th><th>Team</th><th>Pl</th><th>W</th><th>D</th><th>L</th><th>F</th><th>Ag</th><th>Diff</th><th>G</th><th>B</th><th>Total</th><th>Pts Scored</th><th>Actions</th></tr>
            </thead>
            <tbody>
                {% for r in rows %}
                <tr>
                    <td>{{ r.rank or '' }}</td>
                    <td>{{ r.team }}</td>
                    <td>{{ r.pl }}</td>
                    <td>{{ r.w }}</td>
                    <td>{{ r.d }}</td>
                    <td>{{ r.l }}</td>
                    <td>{{ r.pts_f }}</td>
                    <td>{{ r.pts_ag }}</td>
                    <td>{{ r.pts_diff }}</td>
                    <td>{{ r.g_pts }}</td>
                    <td>{{ r.b_pts }}</td>
                    <td>{{ r.total }}</td>
                    <td>{{ r.pts_scored }}</td>
                    <td>
                        <button class="edit-btn" onclick="toggleEditRow({{ r.id }})">Edit</button>
                        <form method="POST" action="{{ url_for('admin_leaderboards_delete', row_id=r.id) }}" style="display:inline;" onsubmit="return confirm('Delete row for {{ r.team }}?');">
                            <button type="submit" class="delete-btn">Delete</button>
                        </form>
                    </td>
                </tr>
                <tr id="edit-row-{{ r.id }}" style="display:none;">
                    <td colspan="14">
                        <form method="POST" action="{{ url_for('admin_leaderboards_edit', row_id=r.id) }}" style="display:flex;flex-direction:column;gap:8px;">
                            <div style="display:flex;gap:8px;flex-wrap:wrap;">
                                <div style="flex:1;min-width:150px;"><label>Team</label><input type="text" name="team" value="{{ r.team }}" required></div>
                                <div style="flex:1;min-width:80px;"><label>Pl</label><input type="number" name="pl" value="{{ r.pl }}" min="0"></div>
                                <div style="flex:1;min-width:80px;"><label>W</label><input type="number" name="w" value="{{ r.w }}" min="0"></div>
                                <div style="flex:1;min-width:80px;"><label>D</label><input type="number" name="d" value="{{ r.d }}" min="0"></div>
                                <div style="flex:1;min-width:80px;"><label>L</label><input type="number" name="l" value="{{ r.l }}" min="0"></div>
                            </div>
                            <div style="display:flex;gap:8px;flex-wrap:wrap;">
                                <div style="flex:1;min-width:80px;"><label>F</label><input type="number" name="pts_f" value="{{ r.pts_f }}" min="0"></div>
                                <div style="flex:1;min-width:80px;"><label>Ag</label><input type="number" name="pts_ag" value="{{ r.pts_ag }}" min="0"></div>
                                <div style="flex:1;min-width:80px;"><label>Diff</label><input type="number" name="pts_diff" value="{{ r.pts_diff }}"></div>
                                <div style="flex:1;min-width:80px;"><label>G</label><input type="number" name="g_pts" value="{{ r.g_pts }}" min="0"></div>
                                <div style="flex:1;min-width:80px;"><label>B</label><input type="number" name="b_pts" value="{{ r.b_pts }}" min="0"></div>
                                <div style="flex:1;min-width:80px;"><label>Total</label><input type="number" name="total" value="{{ r.total }}" min="0"></div>
                                <div style="flex:1;min-width:100px;"><label>Pts Scored</label><input type="number" name="pts_scored" value="{{ r.pts_scored }}" min="0"></div>
                            </div>
                            <div style="display:flex;gap:8px;">
                                <button type="submit" class="hero-btn hero-btn-primary">Save</button>
                                <button type="button" class="hero-btn hero-btn-outline" onclick="toggleEditRow({{ r.id }})">Cancel</button>
                            </div>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>

<style>
.edit-btn {
    background: var(--brand-green);
    border: none;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 700;
    font-size: 0.9rem;
}
.edit-btn:hover {
    background: #009e4a;
}
.delete-btn {
    background: #b04b4b;
    border: none;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 700;
    font-size: 0.9rem;
    margin-left: 4px;
}
.delete-btn:hover {
    background: #a03d3d;
}
</style>

<script>
function toggleEditRow(rowId) {
    const editRow = document.getElementById('edit-row-' + rowId);
    if (editRow.style.display === 'none') {
        editRow.style.display = 'table-row';
    } else {
        editRow.style.display = 'none';
    }
}
</script>
{% endblock %}
